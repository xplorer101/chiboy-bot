<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHIBOY BOT - Trading Opportunities</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --border-color: #30363d;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-gold: #f0b429;
            --text-primary: #ffffff;
            --text-muted: #8b949e;
        }
        
        * { box-sizing: border-box; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding-left: 80px;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 80px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            z-index: 1000;
        }
        
        .sidebar-brand { font-size: 1.5rem; font-weight: 700; color: var(--accent-gold); margin-bottom: 2rem; display: flex; flex-direction: column; align-items: center; }
        .sidebar-brand i { font-size: 1.8rem; }
        .sidebar-brand span { font-size: 0.7rem; margin-top: 0.25rem; }
        
        .sidebar-nav { display: flex; flex-direction: column; gap: 0.5rem; flex: 1; }
        
        .sidebar-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-muted);
            text-decoration: none;
            padding: 0.75rem 0.5rem;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.7rem;
            width: 70px;
        }
        
        .sidebar-link i { font-size: 1.3rem; margin-bottom: 0.25rem; }
        .sidebar-link:hover { background: rgba(255,255,255,0.05); color: var(--text-primary); }
        .sidebar-link.active { background: var(--accent-gold); color: #000; }
        
        .sidebar-footer { display: flex; flex-direction: column; align-items: center; padding: 1rem 0; }
        
        .live-dot { width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Mobile */
        .mobile-bottom-nav { display: none; position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-card); border-top: 1px solid var(--border-color); padding: 0.5rem; z-index: 1000; }
        @media (max-width: 768px) { body { padding-left: 0; padding-bottom: 60px; } .sidebar { display: none; } .mobile-bottom-nav { display: flex; justify-content: space-around; } }
        
        .mobile-bottom-nav a { display: flex; flex-direction: column; align-items: center; color: var(--text-muted); text-decoration: none; padding: 0.5rem; font-size: 0.7rem; flex: 1; }
        .mobile-bottom-nav a i { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .mobile-bottom-nav a.active { color: var(--accent-gold); }
        
        /* Main */
        .main { margin-left: 80px; padding: 1.5rem; }
        @media (max-width: 768px) { .main { margin-left: 0; } }
        
        .header { margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 1.8rem; display: flex; align-items: center; gap: 0.5rem; }
        .header .refresh-btn { background: var(--accent-gold); color: #000; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .header .refresh-btn:hover { background: #d4a020; }
        
        .last-update { color: var(--text-muted); font-size: 0.85rem; }
        
        /* Opportunity Cards */
        .opportunity-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }
        
        .opp-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.2s;
        }
        
        .opp-card:hover { border-color: var(--accent-gold); transform: translateY(-2px); }
        
        .opp-card.signal-buy { border-left: 4px solid var(--accent-green); }
        .opp-card.signal-sell { border-left: 4px solid var(--accent-red); }
        .opp-card.no-signal { border-left: 4px solid var(--text-muted); }
        
        .opp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .opp-symbol { font-size: 1.5rem; font-weight: 700; }
        .opp-direction { padding: 0.25rem 0.75rem; border-radius: 20px; font-weight: 700; font-size: 0.9rem; }
        .opp-direction.buy { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
        .opp-direction.sell { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        
        .opp-prices { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem; }
        .opp-price { text-align: center; }
        .opp-price-label { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        .opp-price-value { font-size: 1.1rem; font-weight: 700; }
        .opp-price-value.entry { color: var(--accent-gold); }
        .opp-price-value.sl { color: var(--accent-red); }
        .opp-price-value.tp { color: var(--accent-green); }
        
        .opp-rr { text-align: center; font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: var(--accent-gold); }
        
        .opp-reasons { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 0.75rem; font-size: 0.8rem; }
        .opp-reasons ul { margin: 0; padding-left: 1rem; }
        .opp-reasons li { color: var(--text-muted); margin-bottom: 0.25rem; }
        
        .opp-timeframe { font-size: 0.75rem; color: var(--text-muted); text-align: center; margin-top: 1rem; }
        
        .no-opp { text-align: center; padding: 3rem; color: var(--text-muted); }
        .no-opp i { font-size: 3rem; margin-bottom: 1rem; }
        
        .loading { text-align: center; padding: 3rem; }
        .loading i { font-size: 2rem; animation: spin 1s linear infinite; color: var(--accent-gold); }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .summary-bar { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .summary-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 1rem 1.5rem; display: flex; align-items: center; gap: 1rem; }
        .summary-card .icon { font-size: 1.5rem; }
        .summary-card .count { font-size: 1.5rem; font-weight: 700; }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <!-- Desktop Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-brand"><i class="fas fa-chart-line"></i><span>CHIBOY</span></div>
        <div class="sidebar-nav">
            <a href="/" class="sidebar-link"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
            <a href="/opportunities" class="sidebar-link active"><i class="fas fa-bullseye"></i><span>Opportunities</span></a>
            <a href="/analysis" class="sidebar-link"><i class="fas fa-search"></i><span>Analysis</span></a>
            <a href="/calendar" class="sidebar-link"><i class="fas fa-calendar-alt"></i><span>Calendar</span></a>
            <a href="/sentiment" class="sidebar-link"><i class="fas fa-fire"></i><span>Sentiment</span></a>
            <a href="/trades" class="sidebar-link"><i class="fas fa-history"></i><span>Trades</span></a>
        </div>
        <div class="sidebar-footer"><span class="live-dot"></span><span style="font-size:0.7rem;color:#8b949e;">Live</span></div>
    </nav>
    
    <!-- Mobile Bottom Nav -->
    <nav class="mobile-bottom-nav">
        <a href="/" class="bottom-nav-item"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a href="/opportunities" class="bottom-nav-item active"><i class="fas fa-bullseye"></i><span>Opportunities</span></a>
        <a href="/analysis" class="bottom-nav-item"><i class="fas fa-search"></i><span>Analysis</span></a>
        <a href="/calendar" class="bottom-nav-item"><i class="fas fa-calendar-alt"></i><span>Calendar</span></a>
        <a href="/sentiment" class="bottom-nav-item"><i class="fas fa-fire"></i><span>Sentiment</span></a>
        <a href="/trades" class="bottom-nav-item"><i class="fas fa-history"></i><span>Trades</span></a>
    </nav>
    
    <div class="main">
        <div class="header">
            <h1><i class="fas fa-bullseye" style="color:var(--accent-gold);"></i> Trading Opportunities</h1>
            <button class="refresh-btn" onclick="loadOpportunities()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>
        
        <div class="last-update" id="lastUpdate">
            <i class="fas fa-clock"></i> Last updated: ---
        </div>
        
        <div class="summary-bar" id="summaryBar">
            <div class="summary-card">
                <div class="icon" style="color:var(--accent-green);"><i class="fas fa-arrow-up"></i></div>
                <div>
                    <div class="count" id="buyCount">0</div>
                    <div class="label">Buy Signals</div>
                </div>
            </div>
            <div class="summary-card">
                <div class="icon" style="color:var(--accent-red);"><i class="fas fa-arrow-down"></i></div>
                <div>
                    <div class="count" id="sellCount">0</div>
                    <div class="label">Sell Signals</div>
                </div>
            </div>
            <div class="summary-card">
                <div class="icon" style="color:var(--text-muted);"><i class="fas fa-clock"></i></div>
                <div>
                    <div class="count" id="totalCount">0</div>
                    <div class="label">Total Scanned</div>
                </div>
            </div>
        </div>
        
        <div class="opportunity-grid" id="opportunityGrid">
            <div class="loading"><i class="fas fa-spinner fa-spin"></i> Scanning for opportunities...</div>
        </div>
    </div>

    <script>
        const symbols = [
            'EUR_USD', 'GBP_USD', 'USD_JPY', 'USD_CHF', 'AUD_USD', 'USD_CAD',
            'EUR_GBP', 'EUR_JPY', 'GBP_JPY', 'XAUUSD', 'NAS100', 'SPX500', 
            'US30', 'USOIL', 'BTCUSDT', 'ETHUSDT', 'SOLUSDT'
        ];
        
        function formatPrice(price, symbol) {
            if (!price) return '---';
            if (symbol === 'XAUUSD' || symbol === 'XAGUSD') return price.toFixed(2);
            if (symbol?.endsWith('USDT')) return price.toFixed(2);
            if (symbol?.includes('JPY')) return price.toFixed(3);
            return price.toFixed(5);
        }
        
        async function loadOpportunities() {
            const grid = document.getElementById('opportunityGrid');
            grid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Scanning for opportunities...</div>';
            
            let opportunities = [];
            let buyCount = 0;
            let sellCount = 0;
            
            // Analyze all symbols
            for (const symbol of symbols) {
                try {
                    const response = await fetch('/api/analyze/symbol/' + symbol + '?t=' + Date.now());
                    const data = await response.json();
                    
                    if (data.success && data.ict) {
                        const ict = data.ict;
                        if (ict.signal) {
                            const opp = {
                                symbol: symbol,
                                signal: ict.signal,
                                entry_price: ict.entry_price,
                                stop_loss: ict.stop_loss,
                                take_profit: ict.take_profit,
                                risk_reward: ict.risk_reward,
                                reasons: ict.reasons || [],
                                current_price: data.current_price
                            };
                            opportunities.push(opp);
                            
                            if (ict.signal === 'BUY') buyCount++;
                            else if (ict.signal === 'SELL') sellCount++;
                        }
                    }
                } catch (e) {
                    console.error('Error analyzing', symbol, e);
                }
            }
            
            // Update summary
            document.getElementById('buyCount').textContent = buyCount;
            document.getElementById('sellCount').textContent = sellCount;
            document.getElementById('totalCount').textContent = symbols.length;
            document.getElementById('lastUpdate').innerHTML = '<i class="fas fa-clock"></i> Last updated: ' + new Date().toLocaleTimeString();
            
            // Render opportunities
            if (opportunities.length === 0) {
                grid.innerHTML = `
                    <div class="no-opp">
                        <i class="fas fa-search"></i>
                        <h3>No Signals Found</h3>
                        <p>No valid ICT trading opportunities at the moment. Check back later.</p>
                    </div>
                `;
            } else {
                // Sort: BUY first, then SELL
                opportunities.sort((a, b) => {
                    if (a.signal === 'BUY' && b.signal !== 'BUY') return -1;
                    if (a.signal === 'SELL' && b.signal !== 'SELL') return 1;
                    return 0;
                });
                
                grid.innerHTML = opportunities.map(opp => `
                    <div class="opp-card signal-${opp.signal.toLowerCase()}">
                        <div class="opp-header">
                            <div class="opp-symbol">${opp.symbol}</div>
                            <div class="opp-direction ${opp.signal.toLowerCase()}">${opp.signal}</div>
                        </div>
                        <div class="opp-prices">
                            <div class="opp-price">
                                <div class="opp-price-label">Entry</div>
                                <div class="opp-price-value entry">${formatPrice(opp.entry_price, opp.symbol)}</div>
                            </div>
                            <div class="opp-price">
                                <div class="opp-price-label">Stop Loss</div>
                                <div class="opp-price-value sl">${formatPrice(opp.stop_loss, opp.symbol)}</div>
                            </div>
                            <div class="opp-price">
                                <div class="opp-price-label">Take Profit</div>
                                <div class="opp-price-value tp">${formatPrice(opp.take_profit, opp.symbol)}</div>
                            </div>
                        </div>
                        <div class="opp-rr">${opp.risk_reward || '1:3'}</div>
                        <div class="opp-reasons">
                            <ul>
                                ${opp.reasons.map(r => `<li>${r}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="opp-timeframe">
                            <i class="fas fa-clock"></i> Real-time data
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // Load on page load
        loadOpportunities();
        
        // Auto-refresh every 60 seconds
        setInterval(loadOpportunities, 60000);
    </script>
</body>
</html>
